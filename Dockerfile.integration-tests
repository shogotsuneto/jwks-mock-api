# Build stage for integration tests
FROM golang:1.23-alpine AS test-builder

# Install ca-certificates for TLS and minimal dependencies for integration tests 
RUN apk add --no-cache ca-certificates curl

WORKDIR /app

# Copy only the integration test directory
COPY test/integration/ ./

# Download dependencies
ENV GOPROXY=direct
ENV GOSUMDB=off
RUN go mod download
RUN go mod verify

# Create test results directory
RUN mkdir -p /app/results

# Run integration tests by default
CMD ["go", "test", "-v", "-count=1", "./..."]