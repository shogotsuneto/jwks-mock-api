# Build stage for integration tests
FROM golang:1.23 AS test-builder

# Install ca-certificates for TLS
RUN apt-get update && apt-get install -y ca-certificates && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Copy only the integration test directory
COPY test/integration/ ./

# Create test results directory
RUN mkdir -p /app/results

# Run integration tests by default using vendor mode
CMD ["go", "test", "-mod=vendor", "-v", "-count=1", "./..."]